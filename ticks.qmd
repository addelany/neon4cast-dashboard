---
title: "Ticks"
---

```{r, include=FALSE}
knitr::opts_chunk$set(echo = FALSE, message=FALSE, warning=FALSE, eval=FALSE)
```

```{r, setup}
library(ggiraph)
library(patchwork)
library(tidyverse)
library(neon4cast)
library(score4cast)
library(thematic)
thematic_rmd(bg="white", fg="black", accent="blue")

source("R/plot-utils.R")

```

```{r}
combined <- combined_scores("ticks") |>
  score4cast::include_horizon()

```

## Most recent forecasts

```{r}
min_data <- 10
day <- combined |>
  filter(!is.na(observation)) |>
  count(variable, model_id, reference_datetime, site_id) |>
  filter(n >= min_data) |> 
  filter(reference_datetime == max(reference_datetime)) |> # must happen second
  select(reference_datetime) |> distinct(reference_datetime) |> first()

```

Below is the latest forecasts for which we have at least `r min_data` observations. Mouse over to see the team id, scroll to zoom. Note that due to latency of data collection for ticks, 'forecasts' lag considerably behind current dates.

::: panel-tabset
## *Amblyomma americanum*

```{r}
combined |> 
  filter(reference_datetime == day, variable == "amblyomma_americanum") |> 
  forecast_plots()
```

## *Ixodes scapularis*

```{r}
combined |> filter(reference_datetime == day, variable == "ixodes_scapularis") |> forecast_plots()
```
:::

```{r}
filled_scores <- fill_scores(combined, "tickGlobalNull_RandomWalk")
```

## Leaderboard

```{r}

leaderboard <-  filled_scores %>% 
  group_by(variable, model_id) %>%
  summarise(crps = mean(crps),
            logs = mean(logs, na.rm=TRUE)) %>% 
  arrange(crps)
leaderboard %>% DT::datatable(fillContainer = FALSE, escape=FALSE)
```

### *Amblyomma americanum*

```{r}
leaderboard_plots(leaderboard, NULL, "amblyomma_americanum")
```

<!-- Consider adding site-by-site breakout on scores -->
